<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>JSON Streams Tokenizer Test</title>
	<style>body { background: #333; color: #ccc;  }</style>
</head>
<body>
<h1>JSON Streams Tokenizer Test</h1>
<script type="module">
import { JSONStreamParser } from "../dist/json-stream-parser.esm.js";

const delegate = {
	key(label) {
		console.info("key", label);
	},

	null() {
		console.info("null");
	},
	true() {
		console.info("true");
	},
	false() {
		console.info("false");
	},

	number(value) {
		console.info(value);
	},
	string(value) {
		console.info(value);
	},

	objectStart() {
		console.info("{");
	},
	objectEnd() {
		console.info("}");
	},

	arrayStart() {
		console.info("[");
	},
	arrayEnd() {
		console.info("]");
	},

	error(message) {
		console.warn(message);
	},
};

async function runTest(collection, index, expectedError) {
	const parser = new JSONStreamParser(delegate);
	const text = await fetch(`./jsonchecker/${collection}${index}.json`).then(r => r.text());
	const chars = text.split("");
	for (const c of chars) {
		parser.append(c);
	}
	console.info(index, "complete", parser.completed);
	console.info("--------");
}

for (let x = 1; x < 34; ++x) {
	runTest("fail", x);
}

</script>
</body>
</html>
